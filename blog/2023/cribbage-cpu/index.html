<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Development of a Cribbage CPU Player | Alex Hay</title> <meta name="author" content="Alex Hay"/> <meta name="description" content="Portfolio for Alex Hay | Robotics X Neuroscience "/> <meta name="keywords" content="robotics, neuroscience, engineering, mechanics"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/favicon.png"/> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://xeroblaze0.github.io/blog/2023/cribbage-cpu/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span>Alex&nbsp;</span>Hay</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item active"> <a class="nav-link" href="/blog/">Projects<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Development of a Cribbage CPU Player</h1> <p class="post-meta">July 30, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a> &nbsp; &middot; &nbsp; <a href="/blog/tag/math"> <i class="fas fa-hashtag fa-sm"></i> math</a> &nbsp; <a href="/blog/tag/stats"> <i class="fas fa-hashtag fa-sm"></i> stats</a> &nbsp; <a href="/blog/tag/python"> <i class="fas fa-hashtag fa-sm"></i> python</a> &nbsp; </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="cribbage">Cribbage</h2> <p>Cribbage is a 2+ person card game that uses a distinctive board to keep track of points. The game is played in hands with players discarding into a crib that alternates between counting towards each player’s score. Points are gained through card combinations in their hand and card combinations from play. The first player to 121 wins. It’s a great game to geek out on.</p> <div class="img_row"> <img class="col three" src="/assets/cribbage/Untitled.jpeg"/> </div> <p><br/></p> <h3 id="stats-gone-mad">Stats Gone Mad</h3> <p>I started with a python framework from <a href="https://github.com/jonathanmcmahon/cribbage">Github</a>. This repo seemed like a good base to start from; a few other people started from it and even corrected a scoring bug. A couple of interesting things to note: first, the deck is a object made of two dictionaries, one of suits and one of ranks, and the deck itself is a list of card objects. There’s a couple of deck-specific functions built into the class, like draw() and shuffle(). There’s two built in players, one a user controls, the other random. The random player uses no analysis for cribbing or playing cards but does provide an example of what the program expects.</p> <p>AI: Cribbage is a great game for stats and the nauances can make or break a game by a point. Every move and decision carries weight, and the tiniest details can spell the difference between triumph and defeat. Cribbage challenges players to master the art of precision and calculation. Whether it’s analyzing the probability of a winning hand or strategically discarding cards, the thrill lies not only in the gameplay itself, but also in the endless possibilities for statistical exploration and strategic decision-making.</p> <h3 id="building-out-the-cpu-player">Building out the CPU Player</h3> <p>The first thing I wanted to tackle was the decision process for discarding to the crib. The situation is static and really where all the analysis fun is. I started with evaluating starter card options. The program iterates through each hand + starter combination and tally’s up the hand score:</p> <div class="img_row"> <img class="col three" src="/assets/cribbage/Figure_01.png"/> </div> <p>In this instance we can see any 4 card combo-ing nicely with the pair of 5’s and the 6, for two 3-card straights and two 15’s. Likewise, 5’s 7’s and 9’s receive the same score through three-of-a-kind, straights, and combos of 15, respectively. This scenarios is 1 of 46 within 14 other possible hand combinations.</p> <h4 id="strategy">Strategy</h4> <p>The latitude by which one hand can vary provides a great field to “play ball” in. For instance if we look at the fact that 5, 7, and 9 would all provide the same score, they do not have the same likelihood of occuring. Our hand already has two 5’s so pulling another 5 is 2 in 46 (4.34%), while a 7 or 9 is twice as likely to occur with 4 in 46 (8.70%). Similarly 4 provides us with the highest score and has a 4 in 46 chance of occuring, however, every face card is also unaccounted for and (including the 10’s) has a 16 in 42 chance of occuring, almost 1 in 3. Amazing. What do these differences in scoring and likelihood mean?</p> <p>Well, we’ve really asked ourselves three-ish questions; what is the top score, what is the most probable, and what is the average?</p> <div class="img_row"> <img class="col three" src="/assets/cribbage/Figure_03.png"/> </div> <p>I consolidated the data into three 3D symmetrical graphs. They are symmetrical along the diagonal because you can’t discard a card you’ve already discarded. Behind the scenes I used permutations of each hand rather than combinations because it made the math behind the scenes easier.</p> <ul> <li>The <i>top score</i> is probably the easiest to understand. It’s the most optimistic, the “ooo, if I just get this card I win the game” mentality, but often not very likely to happen.</li> <li>The <i>most probable score</i> is the score you’ll most likely receive. As mentioned before all face cards (and 10’s) have a value of 10, meaning there are 16 cards with a value of 10, as opposed to just 4. Your most likely score will bias towards what those higher cards will give you, simply because there’s more higher value cards.</li> <li>The <i>average score</i> fills in the gap between top score and most likely, what I call a soft indicator of hand strength. It averages score across all combinations of hand and starter.</li> </ul> <p>Some of the math requires estimating the potential crib hand, which is unknowable. We can either disregard it or dive whole hog into stats, so lets get the wet suit on. <a href="http://www.cribbageforum.com/YourCrib.htm#addition">Discard tables</a> indicate the average number of points a crib will be worth if you discard a particular two-card combination and I included four in the program; Hessel, Colvert, Rasmussen, and Schell. Rasmussen is unique in that it was compiled using real world games rather than computer simulations. This helps capture some of the nuances and counter-plays that aren’t obvious even in play. The tables don’t agree on every detail — the composition of any crib is the result of a decision by two independent players, so it is impossible to arrive at absolute numbers. But taken together, they paint a good picture of what you can actually expect in your games.</p> <h3 id="outro--future-work">Outro &amp; Future Work</h3> <p>There’s a lot of places you can go armed with this information and a lot of different ways to play the game, but this is how I wrapped it up:</p> <p><code class="language-plaintext highlighter-rouge">return crib_permus[np.argmax(score_aves)]</code></p> <p>This returns the discard combo with the highest average score. The <i>top score</i> approach is too much of a silver bullet to be viable, and the <i>most likely</i> approach generally gives low scores (go figure). Highest average score does a good chunk of the leg work. Here’s test run against the RandomCPU player:</p> <div class="img_row"> <img class="col three" src="/assets/cribbage/Figure_04.png"/> </div> <p><br/> Winner!</p> <p>Future work would complete the other half of cribbage gameplay, pegging. Crib discard is a lot of stat analysis, graphing, and overall strategy of the hand. Pegging on the otherhand is all tactic, but necessarily depends on the discard. There are a few guidelines and situations to follow but it should be a degree more straight-forward than crib analysis.</p> </div> </article></div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> &copy; Copyright 2024 Alex Hay. Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>. Last updated: June 26, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>